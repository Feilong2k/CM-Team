# Bug Report B-0003

## Title
Chat “Scroll to newest message” indicator does not appear when AI finishes a streaming reply while user is scrolled up

## Description
The icon-only “Scroll to newest message” indicator (Subtask **2-1-11**) is intended to appear when the user is not at the bottom of the chat and new content arrives.

In real usage, the AI reply is streamed into the **existing** last AI message (same message object), and then the UI flips that message from `isStreaming: true` to `isStreaming: false` when complete.

When the user is reading older content (scrolled up), the indicator is not appearing reliably at the moment the AI finishes the current streaming message.

This makes it easy to miss that the conversation advanced and forces manual scrolling.

## Steps to Reproduce
1. Open the app and go to the Chat Panel.
2. Send a message that produces a longer AI reply (streaming).
3. While the AI is still streaming, scroll up to read older messages so you are **not** near the bottom.
4. Wait until the AI finishes streaming.

## Expected Behavior
When the AI finishes streaming (i.e., the current AI message completes) and the user is not at bottom, the UI should display the icon-only indicator (down arrow) so the user can jump to the newest message.

## Actual Behavior
The icon is not visible even though the newest content finished while the user was scrolled up.

## Notes / Likely Cause
The current indicator logic primarily triggers on **new non-streaming AI message object append** events.
However, real streaming updates mutate the **same** message object and then toggle `isStreaming` to `false`, which may not be handled consistently for indicator triggering.

There is also a possibility of styling/visibility confusion (button is `bg-neon-blue` on dark background), but the dominant issue appears to be trigger logic tied to “new message” rather than “current message completed”.

## Impact
Medium. Users can miss when a response completes while they are scrolled up, reducing usability.

## Suggested Next Steps
- Update scroll indicator logic to trigger when an AI message transitions from `isStreaming:true → false` while `shouldAutoScroll` is false / user is not at bottom.
- Add a simple manual QA checklist for this scenario (scroll up during streaming, wait for completion).
- Optionally add an E2E-style UI test for this scenario (if/when test harness exists).

## Priority
Medium

## Reporter
User report (via Cline)

## Date
2025-12-22
